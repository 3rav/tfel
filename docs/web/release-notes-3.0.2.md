% Release notes of the 3.0.2 version of `TFEL`, `MFront` and `MTest`
% Thomas Helfer
% 2017

# Tickets fixed

## Ticket #84: Check the `NTENS` value in the `Abaqus` interface

The value of the `NTENS` value was not used to check that the function
called was consistent with the modelling hypothesis used.

For more details, see: <https://sourceforge.net/p/tfel/tickets/84/>

## Ticket #82: Python interface is broken if no material name if not defined

For more details, see: <https://sourceforge.net/p/tfel/tickets/82/>

## Ticket #81: Have two versions of MFront in the same environment

In `cmake`, the `TFEL_APPEND_VERSION` option will append the version
number to the names of:

- The executables.
- The libraries.
- The python modules. Note that, to comply with `python` restriction
  on module' names, the characters `.` and `-` are replace by `_` and
  that only the first level modules are affected.
- The directories in the `share` folder.

The headers are installed in a subforder named `TFEL-${TVEL_VERSION}`.

For example, if the `TFEL` version is `3.0.2-dev`, using
`TFEL_APPEND_VERSION` opion will generate:

- The `mfront-3.0.2-dev` executable.
- The `libTFELMaterial-3.0.2-dev.so` library.
- The `mtest_3_0_2_dev` `python` module.
- The `tfel_3_0_2_dev.material` `python` module. In this case, the
  second level (`material`) is not affected.

This allows multiple executables to be installed in the same
directory.

### The `tfel-config` tool

The `tfel-config` tool has been modified to take this
option appropriately. For example:

~~~~{.bash}
$ tfel-config-3.0.2-dev --includes
-I/tmp/install/include/TFEL-3.0.2-dev
$ tfel-config-3.0.2-dev --libs --material
-L/tmp/install/lib -lTFELMaterial-3.0.2-dev -lTFELMath-3.0.2-dev -lTFELUtilities-3.0.2-dev -lTFELException-3.0.2-dev
~~~~

### Modifications to `mfront`

`mfront` has been modified to call the appropriate `tfel-config`
executable.

For more details, see: <https://sourceforge.net/p/tfel/tickets/81/>

### An helper function for importing `TFEL` modules

~~~~{.python}
import os, importlib

def python_module_version(v):
    """Return the python module extension from the TFEL version"""
    return v.replace('.','_').replace('-','_')

def import_tfel_module(n,*v):
    """Try to import a tfel module, taking into account the TFEL_VERSION environment variable."""
    if not n:
        ImportError('Empty module name')
    m   = n.split('.')
    if not v:
        env = os.environ;
        if('TFEL_VERSION' in env):
            v = env.get('TFEL_VERSION')
            m[0] = m[0]+'_'+python_module_version(v)
    elif len(v)==1:
        m[0] = m[0]+'_'+python_module_version(v[0])
    else:
        ImportError('Invalid number of arguments')
    return importlib.import_module('.'.join(m))
~~~~

## Ticket #80: Adding the possiblity to compile a law using python module

`MFront` relies on external tools, called generators, for this step
(this semantic is the same than the one used by `cmake`).

The only available generator is currently the `Makefile` generator,
handled by the `MakefileGenerator` class. This generator can be used
as follows:

~~~~{.python}
import mfront
dsl = mfront.getDSL("Chaboche.mfront")

dsl.setInterfaces(['castem'])
dsl.analyseFile("Chaboche.mfront")
dsl.generateOutputFiles()

m = mfront.MakefileGenerator()
m.exe(dsl.getTargetsDescription())
~~~~

The `exe` methods provides several overloads and may accept an
additional argument of type `GeneratorOptions` which let the user
specifiy the optimisation level to be used.

For more details, see: <https://sourceforge.net/p/tfel/tickets/80/>

## Ticket #78: Fix transpose of `st2tost2` when using rvalue reference

The definition of the transpose of `st2tost2` was broken when the
argument was an rvalue reference.

For more details, see: <https://sourceforge.net/p/tfel/tickets/78/>

## Ticket #77: operators `*=` and `/=` are broken for fourth order tensors

The operators `*=` and `/=` are broken for fourth order tensors: the
`std::is_same` metafunction return value must be accessed with the
`value` member, not the `cond` member. This was a reminiscence an old
remove class called `tfel::meta::IsSame` which was removed in
`TFEL-3.0`.

For more details, see: <https://sourceforge.net/p/tfel/tickets/77/>

## Ticket #75: Support for `python3` in the python interface

The code generated by mfront with the python interface is not
compatible with `python3`. The trouble is linked to changes in the
module declaration. See
<https://docs.python.org/3/howto/cporting.html> for details.

For more details, see: <https://sourceforge.net/p/tfel/tickets/75/>

## Ticket #73 AbaqusExplicit: wait for tasks termination when the `ThreadPool` threading model is used

The `ThreadPool` class now has a `wait` method that stops the main
thread up to tasks completion. This method is now called at the end of
the integration in the `AbaqusExplicit` interface when the
`ThreadPool` threading model is used.

For more details, see: <https://sourceforge.net/p/tfel/tickets/73/>

## Ticket #72: Error at compilation of documentation

The latex documents declared a unnecessary dependency to the
`stmaryrd` package. This package became outdated in recent `LaTeX`
distributions causing some portability issues. This dependency has
been removed.

The inclusion of the `babel` package was missing in the
`docs/presentations/mfront-formation-tp/tp.tex.in` file.

For more details, see: <https://sourceforge.net/p/tfel/tickets/72/>

## Ticket #69: `@Profiling` true; Error in cygwin

Under Windows, the `__declspec(dllexport)` attribute does not
propagate to inner structures, wheres the visibility flags used under
`POSIX` systems does. This attribute is now set also on the
`BehaviourProfiler::Timer` structure.

For more details, see: <https://sourceforge.net/p/tfel/tickets/69/>

## Ticket #70: `PLASTIC` + `MFRONT` in `CalculiX`

`CalculiX` provides two interfaces to `ABAQUS` `umat` behaviours. In
versions prior to 2.12, those interfaces are not fully compatible with
`ABAQUS` concerning various checks. The issue has been reported to
`CalculiX` developers.

To circumvent those issues, the `MFRONT_ABAQUS_NORUNTIMECHECKS` flag
has been added. This flag desactivates:

- checks related to the number of material properties (value of
  `NPROPS`)
- checks related to the number of state variables (value of `NSTATV`)
- checks related to usage of the behaviour in finite strain analysis
  (`KSTEP`)

All those checks may fail with the `ABAQUS` and `ABAQUSNL` interfaces
in `CalculiX` for reasons described in the previous posts. This flag
can be set as follows:

~~~~{.bash}
mfront --obuild --interface=abaqus -D MFRONT_ABAQUS_NORUNTIMECHECKS SaintVenantKirchhoffElasticityTotalLagrangian.mfront
~~~~

For more details, see: <https://sourceforge.net/p/tfel/tickets/70/>

## Ticket #64: Change the library prefix to "cyg" under cygwin

The default library prefix under cygwin has been changed to `cyg`
(rather than `lib`) to follow the standard conventions of this
environment.

For more details, see: <https://sourceforge.net/p/tfel/tickets/84/>

## Ticket #63: Error cygwin (make)

Compiling `MFront` under `Cygwin` was broken because the `_GNU_SOURCE`
macro was not defined in the following headers:

- `mfront\tests\properties\test-cxx.cxx`
- `src\System\ProcessManager.cxx`
- `src\System\SignalManager.cxx`

For more details, see: <https://sourceforge.net/p/tfel/tickets/83/>

## Ticket #58: Fix initialisation of an array of parameters

For more details, see: <https://sourceforge.net/p/tfel/tickets/58/>

## Ticket #57: More robust detection of python versions: avoid mismatch between the python libraries, the python interpreter and the boost python library

For more details, see: <https://sourceforge.net/p/tfel/tickets/57/>

## Ticket #54: Bug in StensorFromTinyVectorView: standard assignement fails

For more details, see: <https://sourceforge.net/p/tfel/tickets/54/>

## Ticket #53: Add comments handling in parameters txt files

For more details, see: <https://sourceforge.net/p/tfel/tickets/53/>

## Ticket #52: More robust handling of parameters txt file

For more details, see: <https://sourceforge.net/p/tfel/tickets/52/>

<!-- Local IspellDict: english -->
